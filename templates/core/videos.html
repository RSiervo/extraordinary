{% extends 'core/base.html' %}
{% load static %}
{% block title %}Videos — Extraordinary{% endblock %}
{% block content %}

<!-- VIDEO GRID -->
<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-8 px-4 items-start">





  {% for feature in features %}
  <div
    data-aos="zoom-in"
    class="group bg-slate-800/50 border border-slate-700 hover:border-green-400 rounded-2xl overflow-hidden shadow-md hover:shadow-green-400/30 transition-all duration-500 flex flex-col"
  >
    <!-- Thumbnail -->
    <div class="relative w-full aspect-[16/9] overflow-hidden">
      {% if feature.image %}
        <img src="{{ feature.image.url }}" alt="{{ feature.title }}"
             class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
      {% else %}
        <img src="{% static 'images/default-thumbnail.jpg' %}" alt="Thumbnail"
             class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
      {% endif %}
      <div class="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300">
        {% if feature.video_url %}
          <button class="bg-green-500 text-white rounded-full p-4 hover:bg-green-400 transition"
            onclick="openVideoModal('{{ feature.video_url }}', '{{ feature.title }}')">
            <i class="fas fa-play text-lg"></i>
          </button>
        {% elif feature.uploaded_video %}
          <button class="bg-green-500 text-white rounded-full p-4 hover:bg-green-400 transition"
            onclick="openVideoModal('{{ feature.uploaded_video.url }}', '{{ feature.title }}')">
            <i class="fas fa-play text-lg"></i>
          </button>
        {% endif %}
      </div>
    </div>

    <!-- Card Content -->
    <div class="p-4 flex flex-col flex-grow">
      <h2 class="text-lg font-semibold text-green-400 truncate">{{ feature.title }}</h2>

      <p class="text-slate-400 text-sm mt-2 description collapsed transition-all duration-300 ease-in-out">
        {{ feature.description }}
      </p>

      <button onclick="toggleDescription(this)" class="text-xs text-green-400 mt-2 hover:text-teal-300 transition">
        Show more
      </button>
    </div>
  </div>

  {% empty %}
  <div class="col-span-full text-center text-slate-500 py-10">
    <i class="fas fa-video-slash text-5xl mb-4"></i>
    <p>No videos available yet.</p>
  </div>
  {% endfor %}
</div>

<!-- VIDEO MODAL -->
<div id="videoModal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center">
  <div class="relative w-full max-w-3xl mx-4">
    <button class="absolute -top-10 right-0 text-white text-3xl hover:text-green-400" onclick="closeVideoModal()">&times;</button>
    <div id="nowPlayingTitle" class="absolute top-3 left-4 text-green-400 font-bold text-lg animate-pulse hidden"></div>

    <div id="videoContainer" class="w-full aspect-[16/9] rounded-lg overflow-hidden">
      <!-- iframe or video injected dynamically -->
    </div>
  </div>
</div>

<script>
// ✅ Universal video modal (YouTube, Vimeo, Dailymotion, direct MP4)
function openVideoModal(url, title) {
  const container = document.getElementById("videoContainer");
  const modal = document.getElementById("videoModal");
  const nowPlaying = document.getElementById("nowPlayingTitle");

  let embedHTML = "";

  if (url.includes("youtube.com") || url.includes("youtu.be")) {
    const videoId = url
      .replace("https://www.youtube.com/watch?v=", "")
      .replace("https://youtu.be/", "")
      .split("&")[0];
    embedHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1"
                   class="w-full h-full" frameborder="0"
                   allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                   allowfullscreen></iframe>`;
  } else if (url.includes("vimeo.com")) {
    const videoId = url.split("/").pop();
    embedHTML = `<iframe src="https://player.vimeo.com/video/${videoId}?autoplay=1"
                   class="w-full h-full" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>`;
  } else if (url.includes("dailymotion.com")) {
    const videoId = url.split("/video/")[1];
    embedHTML = `<iframe src="https://www.dailymotion.com/embed/video/${videoId}?autoplay=1"
                   class="w-full h-full" frameborder="0" allow="autoplay" allowfullscreen></iframe>`;
  } else if (url.endsWith(".mp4") || url.endsWith(".webm") || url.endsWith(".ogg")) {
    embedHTML = `<video src="${url}" class="w-full h-full" controls autoplay></video>`;
  } else {
    embedHTML = `<iframe src="${url}" class="w-full h-full" frameborder="0" allowfullscreen></iframe>`;
  }

  container.innerHTML = embedHTML;
  nowPlaying.textContent = title;
  nowPlaying.classList.remove("hidden");
  modal.classList.remove("hidden");
}

function closeVideoModal() {
  const container = document.getElementById("videoContainer");
  const modal = document.getElementById("videoModal");
  document.getElementById("nowPlayingTitle").classList.add("hidden");
  container.innerHTML = "";
  modal.classList.add("hidden");
}

// ✅ Expand only the clicked description
function toggleDescription(button) {
  const description = button.previousElementSibling;
  const expanded = description.classList.toggle("expanded");
  description.classList.toggle("collapsed", !expanded);
  button.textContent = expanded ? "Show less" : "Show more";
}
</script>

<style>
/* Make cards equal height */
.grid > div {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

/* Description clamp simulation */
.description {
  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  transition: all 0.3s ease-in-out;
  text-align: justify;   /* ✅ This line makes text justified */
}


/* ✅ Custom collapsed/expanded behavior (no global Tailwind interference) */
.description.collapsed {
  line-clamp: 3;              /* Standard property */
  -webkit-line-clamp: 3;      /* For WebKit browsers like Chrome, Safari, Edge */
}

.description.expanded {
  line-clamp: unset;
  -webkit-line-clamp: unset;
}
</style>

{% endblock %}
